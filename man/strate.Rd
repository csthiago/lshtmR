% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mh_fun.R
\name{strate}
\alias{strate}
\title{Calculate Incidence Rates with Confidence Intervals}
\usage{
strate(data, event, time, strata = NULL, per = 1000, conf.level = 0.95)
}
\arguments{
\item{data}{A data frame containing the variables for analysis.}

\item{event}{Character string specifying the name of the event/case count variable.
Should contain numeric values representing the number of events (typically 0 or 1
for individual-level data, or counts for aggregated data).}

\item{time}{Character string specifying the name of the person-time variable.
Should contain numeric values representing the follow-up time (e.g., person-years).}

\item{strata}{Character string or vector specifying the stratification variable(s).
If \code{NULL} (the default), calculates the overall rate.}

\item{per}{Numeric value specifying the multiplier for rate display.
Default is 1000 (rates per 1000 person-time units).}

\item{conf.level}{Numeric value between 0 and 1 specifying the confidence level
for the confidence interval. Default is 0.95 (95\% CI).}
}
\value{
Invisibly returns a data frame with the following columns:
\describe{
\item{stratum}{Stratum identifier (if stratified).}
\item{events}{Number of events.}
\item{person_time}{Total person-time at risk.}
\item{rate}{Incidence rate (per specified multiplier).}
\item{ci_lower}{Lower bound of the confidence interval.}
\item{ci_upper}{Upper bound of the confidence interval.}
}
}
\description{
Calculates incidence rates with confidence intervals for cohort or follow-up data.
Can compute overall rates or rates stratified by one or more grouping variables.
Uses the Stata strate method where SE(ln(rate)) = 1/sqrt(D).
}
\details{
The confidence interval is calculated using the method from Stata's strate command:
\itemize{
\item SE(ln(rate)) = 1/sqrt(D) where D is the number of events
\item CI = exp(ln(rate) Â± z * SE(ln(rate)))
}

This method produces confidence intervals that are always positive and have good
coverage properties, especially when the number of events is small.
}
\examples{
# Using the included mortality cohort dataset
data(mortality_cohort)

# Calculate overall mortality rate
strate(mortality_cohort, "death", "person_years")

# Calculate rates by treatment group
strate(mortality_cohort, "death", "person_years", strata = "treatment")

# Calculate rates by severity
strate(mortality_cohort, "death", "person_years", strata = "severity")

# Calculate rates per 100,000 person-years
strate(mortality_cohort, "death", "person_years", per = 100000)

# Calculate rates stratified by multiple variables
strate(mortality_cohort, "death", "person_years", strata = c("treatment", "severity"))

}
\seealso{
\code{\link{mh_analysis}} for rate ratio comparisons between groups.
}
