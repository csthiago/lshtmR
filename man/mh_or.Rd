% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mh_fun.R
\name{mh_or}
\alias{mh_or}
\title{Calculates the Mantel-Haenszel odds ratio for case-control data. For binary
exposures, computes crude or stratified odds ratios with optional pooling.
For multi-level numeric exposures, performs a score test for trend.
Confidence intervals use the Robins-Breslow-Greenland variance estimator.}
\usage{
mh_or(data, exposure, outcome, strata_vars = NULL, conf.level = 0.95)
}
\arguments{
\item{data}{A data frame containing the variables for analysis.}

\item{exposure}{Character string specifying the name of the exposure variable.
Can be binary (2-levels) or multi-level numeric. For binary exposures, the
higher value is treated as "exposed". For multi-level exposures, a trend
test is performed (exposure must be numeric).}

\item{outcome}{Character string specifying the name of the outcome variable.
Must be a binary variable (exactly 2 unique values). The higher value is
treated as "case" and the lower value as "control".}

\item{strata_vars}{Character string or vector of character strings specifying
the stratification variable(s). If \code{NULL} (the default), a crude
(unstratified) odds ratio is calculated. Multiple variables will be combined
using \code{\link[base]{interaction}}. For trend tests, stratification
computes u and v within each stratum and pools across strata.}

\item{conf.level}{Numeric value between 0 and 1 specifying the confidence level
for the confidence interval. Default is 0.95 (95\% CI).}
}
\value{
Invisibly returns a list with the following components:
\describe{
\item{OR_MH}{The Mantel-Haenszel odds ratio (pooled, crude, or per-unit for trend).}
\item{CI_lower}{Lower bound of the confidence interval.}
\item{CI_upper}{Upper bound of the confidence interval.}
\item{se_ln_or}{Standard error of the log odds ratio.}
\item{chi2}{Chi-squared test statistic (association or trend).}
\item{p_value}{P-value from the chi-squared test.}
\item{n_total_strata}{Total number of strata formed (NA if unstratified or trend).}
\item{n_informative}{Number of informative strata (NA if unstratified or trend).}
\item{strata_data}{Data frame with stratum-specific cell counts (NULL if unstratified or trend).}
\item{homogeneity_Q}{Q statistic for test of homogeneity (NA if unstratified or trend).}
\item{homogeneity_df}{Degrees of freedom for homogeneity test (NA if unstratified or trend).}
\item{homogeneity_p}{P-value for homogeneity test (NA if unstratified or trend).}
\item{type}{Character string: "trend" if trend test was performed (NULL otherwise).}
}
}
\description{
Calculates the Mantel-Haenszel odds ratio for case-control data. For binary
exposures, computes crude or stratified odds ratios with optional pooling.
For multi-level numeric exposures, performs a score test for trend.
Confidence intervals use the Robins-Breslow-Greenland variance estimator.
}
\details{
The function automatically detects the coding of binary variables by sorting
unique values. The higher value is treated as the "positive" category (exposed
or case), and the lower value as the "negative" category (unexposed or control).

For binary exposures with stratification, only informative strata (those
where at least one of ad or bc is positive) contribute to the pooled estimate.
A test of homogeneity (Breslow-Day type) is also performed to assess whether
the stratum-specific odds ratios are consistent.

For multi-level numeric exposures, a Mantel extension score test for trend
is performed. The odds ratio represents the change in odds per one-unit
increase in the exposure variable.

The confidence interval uses the Robins-Breslow-Greenland variance formula
for binary exposures, which matches output from Stata.
}
\examples{
# Using the included lung cancer case-control dataset
data(lung_cancer_cc)

# Crude (unstratified) odds ratio
crude_result <- mh_analysis(lung_cancer_cc, "smoking", "case", measure = "or")

# Stratified by age group
result <- mh_analysis(lung_cancer_cc, "smoking", "case", strata = "age_group", measure = "or")

# Access the odds ratio
result$estimate

}
\seealso{
\code{\link{stmh_r}} for stratified rate ratios,
\code{\link{mh_analysis}} for a unified interface.
}
\keyword{internal}
