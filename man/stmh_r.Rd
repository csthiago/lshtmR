% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mh_fun.R
\name{stmh_r}
\alias{stmh_r}
\title{Stratified Mantel-Haenszel Rate Ratio}
\usage{
stmh_r(
  data,
  event,
  exposure,
  time,
  strata = NULL,
  conf.level = 0.95,
  verbose = TRUE
)
}
\arguments{
\item{data}{A data frame containing the variables for analysis.}

\item{event}{Character string specifying the name of the event/case count variable.
Should contain numeric values representing the number of events (typically 0 or 1
for individual-level data, or counts for aggregated data).}

\item{exposure}{Character string specifying the name of the exposure variable.
Should be a binary variable coded as 0 (unexposed) and 1 (exposed).}

\item{time}{Character string specifying the name of the person-time variable.
Should contain numeric values representing the follow-up time (e.g., person-years).}

\item{strata}{Character string or vector specifying the stratification variable(s).
If \code{NULL} (the default), a crude (unstratified) rate ratio is calculated.}

\item{conf.level}{Numeric value between 0 and 1 specifying the confidence level
for the confidence interval. Default is 0.95 (95\% CI).}
}
\value{
Invisibly returns a list with the following components:
\describe{
\item{strata}{Data frame with stratum-specific results (NULL if unstratified).}
\item{irr}{The Mantel-Haenszel pooled incidence rate ratio.}
\item{se}{Standard error of the log rate ratio.}
\item{ci}{Numeric vector of length 2 containing the confidence interval bounds.}
\item{homogeneity_Q}{Q statistic for the test of homogeneity (NA if unstratified).}
\item{homogeneity_df}{Degrees of freedom for the homogeneity test.}
\item{homogeneity_p}{P-value for the test of homogeneity.}
}
}
\description{
Calculates the Mantel-Haenszel pooled incidence rate ratio (IRR) for stratified
cohort or follow-up data. This function aggregates events and person-time by
stratum and exposure status, computes stratum-specific rate ratios, and provides
the pooled estimate with confidence intervals using the Greenland-Robins variance
estimator.
}
\details{
The function assumes that the exposure variable is coded as 0 (unexposed) and
1 (exposed). Events and person-time are aggregated within each stratum-exposure
combination.

The pooled rate ratio is calculated using the Mantel-Haenszel method, and the
variance is estimated using the Greenland-Robins formula. When stratification
variables are provided, a test of homogeneity (Q statistic) is also performed
to assess whether the stratum-specific rate ratios are consistent.

A warning is issued if any stratum has zero events in either the exposed or
unexposed group, as this can lead to unreliable confidence intervals.
}
\examples{
# Using the included mortality cohort dataset
data(mortality_cohort)

# Crude rate ratio (no stratification)
crude_result <- mh_analysis(mortality_cohort, "treatment", "death",
                            time = "person_years", measure = "irr")

# Stratified by disease severity
strat_result <- mh_analysis(mortality_cohort, "treatment", "death",
                            time = "person_years", strata = "severity", measure = "irr")

# Access the rate ratio
strat_result$estimate

}
\seealso{
\code{\link{mh_or}} for stratified odds ratios,
\code{\link{mh_analysis}} for a unified interface.
}
\keyword{internal}
